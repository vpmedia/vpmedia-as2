/** * Ngon * @author	tPS * @version 1 **/ import com.tPS.ui.util.DragItem; import com.tPS.draw.Point; import com.tPS.draw.Shape; class com.tPS.imageManipulation.LineAutoRotateAndScale extends com.tPS.event.AeventSource{ 	private var _rt:MovieClip;	private var app_mc:MovieClip;	private var draggers:Array;		function LineAutoRotateAndScale($rt:MovieClip){		_rt = $rt;		app_mc = _rt.createEmptyMovieClip("line_aligner",_rt.getNextHighestDepth());		draggers = [];		render();	}		private function render():Void{		//var di_mc:MovieClip = app_mc.createEmptyMovieClip("left",1);		var di_mc:MovieClip = app_mc.attachMovie("eyeL", "left", 1);		//di_mc._x = 160;		di_mc._x = _rt._width/2 - _rt._width/100 * 25;		di_mc._y = _rt._height/2;		//var shp:Shape = new Shape(di_mc);		var di:DragItem = new DragItem(di_mc);		di.addListener(this);		draggers.push(di);				di_mc._xscale = di_mc._yscale *= 100/_rt._parent._xscale;						//var di_mc:MovieClip = app_mc.createEmptyMovieClip("right",2);		var di_mc:MovieClip = app_mc.attachMovie("eyeR","right",2);		//di_mc._x = _rt._width - 160;		di_mc._x =  _rt._width/2 + _rt._width/100 * 25;		di_mc._y = _rt._height/2;		//var shp:Shape = new Shape(di_mc);		var di:DragItem = new DragItem(di_mc);		di.addListener(this);		draggers.push(di);						di_mc._xscale = di_mc._yscale *= 100/_rt._parent._xscale;				drawLine();	}		private function onUpdatePos():Void{		drawLine();	}		private function drawLine(){		app_mc.clear();		app_mc.lineStyle(1,0xD30016,80,true,"none");		var a:Point = draggers[0]._pos;		var b:Point = draggers[1]._pos;		app_mc.moveTo(a.x,a.y);		app_mc.lineTo(b.x,b.y);	}		public function enable(isActive:Boolean):Void{		app_mc._visible = isActive;	}		function get scaleAndRotation():Object{		var rot:Number = 0;		var a:Number = Math.abs(draggers[1]._pos.x - draggers[0]._pos.x);		var b:Number = Math.abs(draggers[1]._pos.y - draggers[0]._pos.y);				var c:Number = Math.sqrt(Math.pow(a,2) + Math.pow(b,2));				if(draggers[1]._pos.y - draggers[0]._pos.y < 0){			var cosA:Number = b/c;			rot = Math.acos(cosA);				rot = rot/(Math.PI/180);			rot = -rot+90;			}else{						var sinA:Number = a/c;			rot = Math.asin(sinA);					rot = rot/(Math.PI/180);			rot = rot -90;			}					trace("rotation: " + rot);				var centery:Number = 0;				if(draggers[0]._pos.y >= draggers[1]._pos.y){			centery = Math.abs(draggers[0]._pos.y - draggers[1]._pos.y)/2 -draggers[1]._pos.y;		}else{			centery = Math.abs(draggers[0]._pos.y - draggers[1]._pos.y)/2 -draggers[0]._pos.y;		}				var centerx:Number = 0;		if(draggers[0]._pos.x >= draggers[1]._pos.x){			centerx = Math.abs(draggers[0]._pos.x - draggers[1]._pos.x)/2 + draggers[1]._pos.x;		}else{			centerx = Math.abs(draggers[0]._pos.x - draggers[1]._pos.x)/2 + draggers[0]._pos.x;		}				var ret:Object = {rotation:rot,center:new Point(centerx,centery),baseLength:c}		return ret;	}		function remove():Void{		app_mc.removeMovieClip();	}}